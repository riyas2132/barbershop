<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Submit Data</title>
  <style>
    :root {
      --primary-color: #4285F4;
      --secondary-color: #34A853;
      --accent-color: #EA4335;
      --light-gray: #f5f5f5;
      --medium-gray: #e0e0e0;
      --dark-gray: #757575;
      --text-color: #333;
      --white: #ffffff;
    }

    body {
      font-family: 'Roboto', Arial, sans-serif;
      background: var(--light-gray);
      padding: 20px;
      color: var(--text-color);
      line-height: 1.6;
      margin: 0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }

    .container {
      background: var(--white);
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      padding: 30px 40px;
      max-width: 500px;
      width: 100%;
      box-sizing: border-box;
    }

    h1 {
      text-align: center;
      color: var(--primary-color);
      font-weight: 500;
      margin-bottom: 30px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--medium-gray);
      user-select: none;
    }

    form label {
      display: block;
      font-weight: 500;
      margin-top: 20px;
      color: var(--dark-gray);
      user-select: none;
    }

    input, textarea {
      width: 100%;
      padding: 10px 12px;
      margin-top: 8px;
      border: 1.5px solid var(--medium-gray);
      border-radius: 6px;
      font-size: 1rem;
      font-family: 'Roboto', Arial, sans-serif;
      box-sizing: border-box;
      transition: border-color 0.3s ease;
    }

    input:focus, textarea:focus {
      border-color: var(--primary-color);
      outline: none;
      box-shadow: 0 0 5px var(--primary-color);
    }

    textarea {
      resize: vertical;
      min-height: 100px;
      font-size: 1rem;
    }

    button {
      margin-top: 30px;
      width: 100%;
      padding: 14px 0;
      background: var(--secondary-color);
      color: var(--white);
      border: none;
      border-radius: 6px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.3s ease;
      user-select: none;
    }

    button:hover:not(:disabled) {
      background: #2c7a32;
    }

    button:disabled {
      background: var(--medium-gray);
      cursor: not-allowed;
      color: #aaa;
    }

    .message {
      margin-top: 25px;
      text-align: center;
      font-weight: 600;
      font-size: 1rem;
      user-select: none;
    }

    .error {
      color: var(--accent-color);
    }

    .success {
      color: var(--secondary-color);
    }

    .loading {
      color: var(--primary-color);
    }

    /* Responsive tweaks */
    @media (max-width: 600px) {
      .container {
        padding: 25px 20px;
      }

      h1 {
        font-size: 1.6rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Submit Entry</h1>
    <form id="entryForm">
      <label for="date">Date *</label>
      <input type="datetime-local" id="date" name="date" required />

      <label for="name">Name *</label>
      <input type="text" id="name" name="name" required />

      <label for="job">Job *</label>
      <input type="text" id="job" name="job" required />

      <label for="amount">Amount *</label>
      <input type="number" id="amount" name="amount" required min="1" step="0.01" />

      <label for="description">Description</label>
      <textarea id="description" name="description" rows="4"></textarea>

      <button type="submit" id="submitBtn">Submit</button>
    </form>

    <div class="message" id="message"></div>
  </div>

  <script>
    const form = document.getElementById('entryForm');
    const messageDiv = document.getElementById('message');
    const submitBtn = document.getElementById('submitBtn');

    // Replace with your actual Google Apps Script Web App URL
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxwPHEJYIBOFeXaqm_JoP-2_He2IN0qHAfyewGI2kE6PB3dl2marAf0Ju5C-6wcvWzQrA/exec';

    form.addEventListener('submit', async function(event) {
      event.preventDefault();

      // Clear message and disable submit button
      messageDiv.textContent = '';
      messageDiv.className = 'message';
      submitBtn.disabled = true;
      submitBtn.textContent = 'Submitting...';

      // Get form values
      const date = document.getElementById('date').value;
      const name = document.getElementById('name').value.trim();
      const job = document.getElementById('job').value.trim();
      const amount = document.getElementById('amount').value;
      const description = document.getElementById('description').value.trim();

      // Validation
      if (!date || !name || !job || !amount) {
        showMessage('Please fill in all required fields.', 'error');
        resetSubmitButton();
        return;
      }

      if (isNaN(amount) || Number(amount) <= 0) {
        showMessage('Amount must be a positive number.', 'error');
        resetSubmitButton();
        return;
      }

      showMessage('Submitting data...', 'loading');

      const data = {
        Date: new Date(date).toISOString(),
        Name: name,
        Job: job,
        Amount: Number(amount),
        Description: description
      };

      try {
        const response = await fetch(SCRIPT_URL, {
          method: 'POST',
          mode: 'no-cors', // This helps with CORS issues
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });

        // no-cors mode means no response reading possible, assume success
        showMessage('Data submitted successfully!', 'success');
        form.reset();

      } catch (error) {
        console.error('Fetch method failed:', error);

        try {
          await submitViaForm(data);
        } catch (formError) {
          console.error('Form method also failed:', formError);
          showMessage(`Error: ${formError.message}. Please check your network connection and try again.`, 'error');
        }
      }

      resetSubmitButton();
    });

    function showMessage(text, type) {
      messageDiv.textContent = text;
      messageDiv.className = `message ${type}`;
    }

    function resetSubmitButton() {
      submitBtn.disabled = false;
      submitBtn.textContent = 'Submit';
    }

    function submitViaForm(data) {
      return new Promise((resolve, reject) => {
        const hiddenForm = document.createElement('form');
        hiddenForm.method = 'POST';
        hiddenForm.action = SCRIPT_URL;
        hiddenForm.style.display = 'none';

        Object.keys(data).forEach(key => {
          const input = document.createElement('input');
          input.type = 'hidden';
          input.name = key;
          input.value = data[key];
          hiddenForm.appendChild(input);
        });

        const iframe = document.createElement('iframe');
        iframe.style.display = 'none';
        iframe.name = 'responseFrame';
        hiddenForm.target = 'responseFrame';

        document.body.appendChild(hiddenForm);
        document.body.appendChild(iframe);

        iframe.onload = function() {
          showMessage('Data submitted successfully!', 'success');
          form.reset();
          document.body.removeChild(hiddenForm);
          document.body.removeChild(iframe);
          resolve();
        };

        iframe.onerror = function() {
          reject(new Error('Form submission failed'));
        };

        hiddenForm.submit();
      });
    }

    // Set default date to current date/time
    function setCurrentDateTime() {
      const now = new Date();
      const year = now.getFullYear();
      const month = String(now.getMonth() + 1).padStart(2, '0');
      const day = String(now.getDate()).padStart(2, '0');
      const hours = String(now.getHours()).padStart(2, '0');
      const minutes = String(now.getMinutes()).padStart(2, '0');
      const dateTimeString = `${year}-${month}-${day}T${hours}:${minutes}`;
      document.getElementById('date').value = dateTimeString;
    }

    document.addEventListener('DOMContentLoaded', setCurrentDateTime);
    setInterval(setCurrentDateTime, 60000);
  </script>
</body>
</html>
